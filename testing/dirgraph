#!/bin/bash

POSIXLY_CORRECT=yes

function error {
	case $1 in
		help) echo "Usage: ./dirgraph [-i PATTERN] [-n] [DIR]" >&2;;
		pattern) echo "Usage: ./dirgraph [-i PATTERN] [-n] [DIR]" >&2;;
	esac

}

# COMMAND LINE PARSE
dir="."
i=""
n=false

setopt=":i:n"		# First colon activate silent mode 
while getopts "$setopt" opt; do
	
	if [[ $OPTARG =~ ^-.* ]]; then		# Required argument testing (! -i -n)
		error "help"
        	exit 1
     	fi

	case $opt in
		i) i="$OPTARG";;
		n) n=true;;
		?) error "help"; exit 1;;
	esac
done

shift $(($OPTIND - 1))		# On $1 shift dir path

if [ -n "$1" -a -d "$1" -a $# -eq 1 ]; then
	dir=$1
elif [ $# -gt 1 -o -n "$1" -a ! -d "$1" ]; then
	error "help"
	exit 1
elif []
fi

# HEADER
echo "Root directory: $dir"
echo "Directories: `find $dir -type d | wc -l`"
echo "All files: `find $dir -type f | wc -l`"
echo "File size histogram:"

echo "$i $n $dir $#"

